<div class="mdp" *ngIf="!okmdp">
  <input type="password" [(ngModel)]="mdp" />
  <button (click)="checkMdp()">Valider</button>
</div>
<div [class.portrait]="portrait" *ngIf="okmdp">

<div class="annee" *ngIf="!jourClicked&&((portrait&&!month)||!portrait)">
  <button (click)="year=year-1"><</button>
  <p class="nopointer">{{year}}</p>
  <button (click)="year=year+1">></button>
</div>

<div class="annee" *ngIf="!jourClicked&&portrait&&month">
  <button (click)="month=undefined;monthIndex=undefined">< Retour</button>
  <p class="nopointer">{{year}}</p>
</div>

<div class="flex center" *ngIf="!jourClicked&&((portrait&&!month)||!portrait)">
  <input type="text" [(ngModel)]="search" placeholder="Recherche.." />
</div>

<div class="calendar" *ngIf="!jourClicked">
  <ng-container *ngIf="(portrait&&!month)||!portrait">
    <div *ngFor="let month of months; let monthIndex = index" class="month" (click)="clickMonth(month, monthIndex)">
      <h3>{{ month +' ('+(monthIndex+1)+')'}}</h3>
      
      <!-- En-tête des jours de la semaine -->
      <div class="week-days">
        <div *ngFor="let day of weekDays">{{ day }}</div>
      </div>

      <div class="days">
        <!-- Espaces vides avant le premier jour du mois -->
        <div *ngFor="let empty of [].constructor(getFirstDayOfMonth(year, monthIndex) === 0 ? 6 : getFirstDayOfMonth(year, monthIndex) - 1)" class="noday">
        </div>

        <!-- Jours du mois -->
        <div class="blockday" *ngFor="let day of getDaysInMonth(year, monthIndex)"
              [class.ant]="isAnt(monthIndex, day, year)"
            [ngClass]="isOccupied(year, monthIndex, day)"
            (mouseenter)="showTooltip($event, monthIndex, day)"
            (mouseleave)="hideTooltip()"
            [class.nopointer]="portrait"
            (click)="clickJour(monthIndex, day, year)"
            >
          {{ day }}
          <p class="events" *ngIf="numberOfEvents(monthIndex, day)>1">{{numberOfEvents(monthIndex, day)}}</p>
        </div>
      </div>
    </div>
  </ng-container>

  <ng-container *ngIf="portrait&&month">
    <div class="month month2">
      <div class="arrows">
        <p (click)="otherMonth(-1)"><</p>
        <p (click)="otherMonth(1)">></p>
      </div>
      <h3>{{ month +' ('+(monthIndex+1)+')'}}</h3>
      
      <!-- En-tête des jours de la semaine -->
      <div class="week-days">
        <div *ngFor="let day of weekDays">{{ day }}</div>
      </div>

      <div class="days">
        <!-- Espaces vides avant le premier jour du mois -->
        <div *ngFor="let empty of [].constructor(getFirstDayOfMonth(year, monthIndex) === 0 ? 6 : getFirstDayOfMonth(year, monthIndex) - 1)" class="noday">
        </div>

        <!-- Jours du mois -->
        <div class="blockday" *ngFor="let day of getDaysInMonth(year, monthIndex)"
              [class.ant]="isAnt(monthIndex, day, year)"
            [ngClass]="isOccupied(year, monthIndex, day)"
            (mouseenter)="showTooltip($event, monthIndex, day)"
            (mouseleave)="hideTooltip()"
            (click)="clickJour(monthIndex, day, year)"
            >
          {{ day }}
          <p class="events" *ngIf="numberOfEvents(monthIndex, day)>1">{{numberOfEvents(monthIndex, day)}}</p>
        </div>
      </div>
    </div>
  </ng-container>
</div>

<app-devis #devis [class.hidden]="jourClicked&&jourClicked.mode==undefined" [data]="jourClicked" (retour)="jourClicked.mode=undefined;"></app-devis>

<div class="formulaire" *ngIf="jourClicked && jourClicked.mode==undefined">
  <p class="retour" (click)="onRetour()">< Retour</p>

  <div class="date">
    <p (click)="changeJour(-1)"><</p>
    <p class="nopointer">{{formatDate(jourClicked.date)}}</p>
    <p (click)="changeJour(1)">></p>
  </div>

  <div class="date date2" *ngIf="otherEvents()>1">
    <p (click)="onRetour(-1)"><</p>
    <p class="nopointer">{{(otherEvents()-1)+ ' autre évênement'}}</p>
    <p (click)="onRetour(1)">></p>
  </div>
  
  <div class="inputs" *ngIf="jourClicked.statut!='essai'">
    <div>
      <p>Date : </p>
      <input type="text" [(ngModel)]="jourClicked.date" placeholder="Date.." [class.red]="diffs&&diffs.date"/>
    </div>
    <div>
      <p>Nom : </p>
      <input type="text" [(ngModel)]="jourClicked.nom" placeholder="Nom.." [class.red]="diffs&&diffs.nom"/>
    </div>
    <div>
      <p>Adresse : </p>
      <input type="text" [(ngModel)]="jourClicked.adresse" placeholder="Adresse.." [class.red]="diffs&&diffs.adresse"/>
    </div>
    <div>
      <p>Code postal & Ville : </p>
      <input type="text" [(ngModel)]="jourClicked.codepostal" placeholder="Code postal & Ville.." [class.red]="diffs&&diffs.codepostal"/>
    </div>
    <div>
      <p>Téléphone : </p>
      <input type="text" [(ngModel)]="jourClicked.tel" placeholder="Téléphone.." [class.red]="diffs&&diffs.tel"/>
    </div>
    <div>
      <p>Mail : </p>
      <input type="text" [(ngModel)]="jourClicked.mail" placeholder="Mail.." [class.red]="diffs&&diffs.mail"/>
    </div>
    <div>
      <p>Statut : </p>
      <select [(ngModel)]="jourClicked.statut" [class.red]="diffs&&diffs.statut">
        <option value="demande">Demande Mariage</option>
        <option value="reserve">Mariage réservé</option>
        <option value="autre">Autre (Shooting, Tournage, Animation..)</option>
      </select>
    </div>
    <div>
      <p>Essai : </p>
      <div class="column">
        <input type="text" maxlength="10" placeholder="Date.." (input)="jourClicked.essai.date=onInput(jourClicked.essai.date)" [(ngModel)]="jourClicked.essai.date" [class.red]="diffs&&diffs.essai&&diffs.essai.date"/>
        <input type="text" placeholder="Lieu.." [(ngModel)]="jourClicked.essai.lieu" [class.red]="diffs&&diffs.essai&&diffs.essai.lieu"/>
        <input type="text" placeholder="Heure.." [(ngModel)]="jourClicked.essai.heure" [class.red]="diffs&&diffs.essai&&diffs.essai.heure"/>
      </div>
    </div>
  </div>

  <div class="inputs" *ngIf="jourClicked.statut=='essai'">
    <div>
      <p>Nom : </p>
      <p>{{jourClicked.nom}}</p>
    </div>
    <div>
      <p>Adresse : </p>
      <p>{{jourClicked.adresse}}</p>
    </div>
    <div>
      <p>Code postal & Ville : </p>
      <p>{{jourClicked.codepostal}}</p>
    </div>
    <div>
      <p>Téléphone : </p>
      <p>{{jourClicked.tel}}</p>
    </div>
    <div>
      <p>Mail : </p>
      <p>{{jourClicked.mail}}</p>
    </div>
    <div>
      <p>Statut : </p>
      <p>{{jourClicked.statut}}</p>
    </div>
    <div>
      <p>Essai : </p>
      <div class="column">
        <p>{{jourClicked.essai.date}}</p>
        <p>{{jourClicked.essai.lieu}}</p>
        <p>{{jourClicked.essai.heure}}</p>
      </div>
    </div>
  </div>

  <div *ngIf="jourClicked.statut!='essai'" class="blocbas">
    <p>Devis : </p>
    <button class="nom" *ngIf="jourClicked.devis&&jourClicked.devis.creation" [class.red]="diffs&&diffs.devis" (click)="clickDevis()">{{formatNumber(jourClicked.devis.numero)+"_"+jourClicked.devis.annee + " ("+jourClicked.devis.creation+")"}}</button>
    <button *ngIf="!jourClicked.devis||!jourClicked.devis.creation" (click)="clickDevis()">Editer</button>
  </div>

  <div *ngIf="jourClicked.statut!='essai'" class="blocbas">
    <p>Factures : </p>
    <select [(ngModel)]="selectedValue" (change)="clickFacture($event)" *ngIf="jourClicked.factures.length>0">
      <option *ngFor="let facture of jourClicked.factures;let i=index" [class.red]="diffs&&diffs.factures&&diffs.factures[i]" [value]="i">{{formatNumber(facture.numero)+"_"+facture.annee + " : "+facture.solde+ "€ ("+facture.creation+")"}}</option>
    </select>
    <button (click)="clickFacture()">Ajouter Facture</button>
  </div>

  <div *ngIf="jourClicked.statut!='essai'" class="blocbas">
    <p>Prestataires : </p>
    <input type="text" [(ngModel)]="jourClicked.prestataires" placeholder="Paiement Prestataires.."/>
  </div>

  <div *ngIf="jourClicked.statut!='essai'" class="blocbas">
    <p>Planning : </p>
    <button>Editer</button>
  </div>

  <div *ngIf="jourClicked.statut!='essai'" class="blocbas">
    <p>Etape : </p>
    <button (click)="clickEtape()">{{getEtape()}}</button>
  </div>

  <div class="resumes" *ngIf="jourClicked.statut!='essai'">
    <div class="prestas" *ngIf="jourClicked.devis.prestas">
      <div class="entetes">
        <p>Qte</p>
        <p>Presta</p>
        <p>Reduc</p>
        <p>Prix</p>
      </div>
      <div></div>
      <div *ngFor="let presta of jourClicked.devis.prestas" class="small">
        <p>{{presta.qte=="?"?"?":presta.qte}}</p>
        <p>{{presta.nom}}</p>
        <p>{{presta.reduc==0||!presta.reduc?"":presta.reduc+"%"}}</p>
        <p>{{calcToString(presta)}}</p>
      </div>
      <div></div>
      <div class="entetes">
        <p>{{jourClicked.factures.length==0?'Arrhes':'Payé' + " : "}}</p>
        <p>{{jourClicked.factures.length==0?calcares():calcPaye()}}</p>
        <p>Total :</p>
        <p>{{calcTot()}}</p>
      </div>
    </div>
  </div>

  <div class="save">
    <button (click)="save()" *ngIf="jourClicked.statut!='essai'">Sauvegarder</button>
    <button (click)="onRetour(2)">Ajouter évênement</button>
    <button (click)="end()">Cloturer</button>
    <button class="delete" (click)="delete()" *ngIf="jourClicked.id&&jourClicked.statut!='essai'">Supprimer</button>
    <button *ngIf="jourClicked.statut=='essai'" (click)="goToWed()">Aller au mariage</button>
  </div>
</div>

<div class="flex legende" *ngIf="!jourClicked">
  <button class="reserve">Réservé</button>
  <button class="demande">Demande</button>
  <button class="essai">Essai</button>
  <button class="autre">Autre (Shooting, Tournage, Animation..)</button>
</div>

<div *ngIf="tooltip.visible" class="tooltip" [ngStyle]="{'top.px': tooltip.y, 'left.px': tooltip.x}">
  <p *ngFor="let date of tooltip.data">{{ date.statut + " : " + date.nom }}</p>
</div>

</div>